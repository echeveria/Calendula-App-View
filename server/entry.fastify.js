var Me=Object.defineProperty;var He=(e,t,n)=>t in e?Me(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var P=(e,t,n)=>He(e,typeof t!="symbol"?t+"":t,n);import"dotenv/config";import $e from"fastify";import{join as A,basename as We,extname as Ne}from"node:path";import{fileURLToPath as ye}from"node:url";import{s as Ie,r as Le}from"./q-CeIiXvQk.js";import{getNotFound as je}from"./@qwik-city-not-found-paths.js";import{isStaticPath as V}from"./@qwik-city-static-paths.js";import{createReadStream as Fe}from"node:fs";import{Http2ServerRequest as Ue}from"node:http2";import{TextEncoderStream as ze,TextDecoderStream as Qe,WritableStream as Ge,ReadableStream as Be}from"node:stream/web";import{fetch as Je,Headers as Ke,Request as Xe,Response as Ye,FormData as Ee}from"undici";import Ze from"crypto";import{v as Ve,_ as qe,a as et}from"./q-BwaYqJ2W.js";import Q from"@fastify/static";import tt from"./@qwik-city-plan.js";import nt from"fastify-plugin";import"pocketbase";var K=class extends Error{constructor(e,t){super(typeof t=="string"?t:void 0),this.status=e,this.data=t}};function rt(e,t){let n="Server Error";return t!=null&&(typeof t.message=="string"?n=t.message:n=String(t)),"<html>"+we(e,n)+"</html>"}function we(e,t){typeof e!="number"&&(e=500),typeof t=="string"?t=it(t):t="";const n=typeof t=="string"?"600px":"300px",r=e>=500?ot:st;return`
<head>
  <meta charset="utf-8">
  <meta http-equiv="Status" content="${e}">
  <title>${e} ${t}</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <style>
    body { color: ${r}; background-color: #fafafa; padding: 30px; font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, Roboto, sans-serif; }
    p { max-width: ${n}; margin: 60px auto 30px auto; background: white; border-radius: 4px; box-shadow: 0px 0px 50px -20px ${r}; overflow: hidden; }
    strong { display: inline-block; padding: 15px; background: ${r}; color: white; }
    span { display: inline-block; padding: 15px; }
  </style>
</head>
<body><p><strong>${e}</strong> <span>${t}</span></p></body>
`}var at=/[&<>]/g,it=e=>e.replace(at,t=>{switch(t){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";default:return""}}),st="#006ce9",ot="#713fc2",ct={lax:"Lax",Lax:"Lax",None:"None",none:"None",strict:"Strict",Strict:"Strict"},lt={seconds:1,minutes:1*60,hours:1*60*60,days:1*60*60*24,weeks:1*60*60*24*7},q=(e,t,n)=>{const r=[`${e}=${t}`];typeof n.domain=="string"&&r.push(`Domain=${n.domain}`),typeof n.maxAge=="number"?r.push(`Max-Age=${n.maxAge}`):Array.isArray(n.maxAge)?r.push(`Max-Age=${n.maxAge[0]*lt[n.maxAge[1]]}`):typeof n.expires=="number"||typeof n.expires=="string"?r.push(`Expires=${n.expires}`):n.expires instanceof Date&&r.push(`Expires=${n.expires.toUTCString()}`),n.httpOnly&&r.push("HttpOnly"),typeof n.path=="string"&&r.push(`Path=${n.path}`);const i=dt(n.sameSite);return i&&r.push(`SameSite=${i}`),n.secure&&r.push("Secure"),r.join("; ")};function ee(e){try{return decodeURIComponent(e)}catch{return e}}var ft=e=>{const t={};if(typeof e=="string"&&e!==""){const n=e.split(";");for(const r of n){const i=r.indexOf("=");i!==-1&&(t[ee(r.slice(0,i).trim())]=ee(r.slice(i+1).trim()))}}return t};function dt(e){if(e===!0)return"Strict";if(e===!1)return"None";if(e)return ct[e]}var _=Symbol("request-cookies"),H=Symbol("response-cookies"),v=Symbol("live-cookies"),he,pe,ge,ut=(ge=_,pe=H,he=v,class{constructor(e){P(this,ge);P(this,pe,{});P(this,he,{});P(this,"appendCounter",0);this[_]=ft(e),this[v]={...this[_]}}get(e,t=!0){const n=this[t?v:_][e];return n?{value:n,json(){return JSON.parse(n)},number(){return Number(n)}}:null}getAll(e=!0){return Object.keys(this[e?v:_]).reduce((t,n)=>(t[n]=this.get(n),t),{})}has(e,t=!0){return!!this[t?v:_][e]}set(e,t,n={}){this[v][e]=typeof t=="string"?t:JSON.stringify(t);const r=typeof t=="string"?t:encodeURIComponent(JSON.stringify(t));this[H][e]=q(e,r,n)}append(e,t,n={}){this[v][e]=typeof t=="string"?t:JSON.stringify(t);const r=typeof t=="string"?t:encodeURIComponent(JSON.stringify(t));this[H][++this.appendCounter]=q(e,r,n)}delete(e,t){this.set(e,"deleted",{...t,maxAge:0}),this[v][e]=null}headers(){return Object.values(this[H])}}),X=class{},Y=class extends X{},te=new WeakMap,ne="qaction",mt="qfunc",re="qdata";function ht(e,t){const n=se(e),r=ae(e),i=se(t),a=ae(t);return be(e,n,r,t,i,a)}function be(e,t,n,r,i,a){let o=null;for(;t<n;){const s=e.charCodeAt(t++),c=r.charCodeAt(i++);if(s===91){const l=Se(e,t),f=t+(l?3:0),m=G(e,f,n,93),d=e.substring(f,m),h=G(e,m+1,n,47),g=e.substring(m+1,h);t=m+1;const y=i-1;if(l){const S=gt(d,g,r,y,a,e,t+g.length+1,n);if(S)return Object.assign(o||(o={}),S)}const w=G(r,y,a,47,g);if(w==-1)return null;const T=r.substring(y,w);if(!l&&!g&&!T)return null;i=w,(o||(o={}))[d]=decodeURIComponent(T)}else if(s!==c&&!(isNaN(c)&&pt(e,t)))return null}return ie(e,t)&&ie(r,i)?o||{}:null}function pt(e,t){return e.charCodeAt(t)===91&&Se(e,t+1)}function ae(e){const t=e.length;return t>1&&e.charCodeAt(t-1)===47?t-1:t}function ie(e,t){const n=e.length;return t>=n||t==n-1&&e.charCodeAt(t)===47}function se(e){return e.charCodeAt(0)===47?1:0}function Se(e,t){return e.charCodeAt(t)===46&&e.charCodeAt(t+1)===46&&e.charCodeAt(t+2)===46}function G(e,t,n,r,i=""){for(;t<n&&e.charCodeAt(t)!==r;)t++;const a=i.length;for(let o=0;o<a;o++)if(e.charCodeAt(t-a+o)!==i.charCodeAt(o))return-1;return t-a}function gt(e,t,n,r,i,a,o,s){n.charCodeAt(r)===47&&r++;let c=i;const l=t+"/";for(;c>=r;){const f=be(a,o,s,n,c,i);if(f){let d=n.substring(r,Math.min(c,i));return d.endsWith(l)&&(d=d.substring(0,d.length-l.length)),f[e]=decodeURIComponent(d),f}const m=yt(n,r,l,c,r-1)+l.length;if(c===m)break;c=m}return null}function yt(e,t,n,r,i){let a=e.lastIndexOf(n,r);return a==r-n.length&&(a=e.lastIndexOf(n,r-n.length-1)),a>t?a:i}var wt=async(e,t,n,r)=>{if(!Array.isArray(e))return null;for(const i of e){const a=i[0],o=ht(a,r);if(!o)continue;const s=i[1],c=i[3],l=new Array(s.length),f=[];s.forEach((h,g)=>{oe(h,f,y=>l[g]=y,n)});const m=bt(t,r);let d;return oe(m,f,h=>d=h==null?void 0:h.default,n),f.length>0&&await Promise.all(f),[a,o,l,d,c]}return null},oe=(e,t,n,r)=>{if(typeof e=="function"){const i=te.get(e);if(i)n(i);else{const a=e();typeof a.then=="function"?t.push(a.then(o=>{r!==!1&&te.set(e,o),n(o)})):a&&n(a)}}},bt=(e,t)=>{if(e){t=t.endsWith("/")?t:t+"/";const n=e.find(r=>r[0]===t||t.startsWith(r[0]+(t.endsWith("/")?"":"/")));if(n)return n[1]}},St=e=>e&&typeof e.then=="function";function Tt(e){const t=[];return e==="day"?e=60*60*24:e==="week"?e=60*60*24*7:e==="month"?e=60*60*24*30:e==="year"?e=60*60*24*365:e==="private"?e={private:!0,noCache:!0}:e==="immutable"?e={public:!0,immutable:!0,maxAge:60*60*24*365}:e==="no-cache"&&(e={noCache:!0}),typeof e=="number"&&(e={maxAge:e,sMaxAge:e}),e.immutable&&t.push("immutable"),e.maxAge&&t.push(`max-age=${e.maxAge}`),e.sMaxAge&&t.push(`s-maxage=${e.sMaxAge}`),e.noStore&&t.push("no-store"),e.noCache&&t.push("no-cache"),e.private&&t.push("private"),e.public&&t.push("public"),e.staleWhileRevalidate&&t.push(`stale-while-revalidate=${e.staleWhileRevalidate}`),e.staleIfError&&t.push(`stale-if-error=${e.staleIfError}`),t.join(", ")}var $;import("node:async_hooks").then(e=>{const t=e.AsyncLocalStorage;$=new t,globalThis.qcAsyncRequestStore=$}).catch(e=>{console.warn("AsyncLocalStorage not available, continuing without it. This might impact concurrent server calls.",e)});function xt(e,t,n,r=!0,i="/",a){let o;const s=new Promise(l=>o=l),c=At(e,t,n,r,i,a,o);return{response:s,requestEv:c,completion:$?$.run(c,ce,c,o):ce(c,o)}}async function ce(e,t){try{await e.next()}catch(n){if(n instanceof Y)await e.getWritableStream().close();else if(n instanceof K){if(!e.headersSent){const r=n.status,i=e.request.headers.get("Accept");if(i&&!i.includes("text/html")){const a=e[O];e.headers.set("Content-Type","application/qwik-json"),e.send(r,await a._serializeData(n.data,!0))}else{const a=rt(n.status,n.data);e.html(r,a)}}}else if(!(n instanceof X)){if(j(e)!=="dev")try{e.headersSent||(e.headers.set("content-type","text/html; charset=utf-8"),e.cacheControl({noCache:!0}),e.status(500));const r=e.getWritableStream();if(!r.locked){const i=r.getWriter();await i.write(F.encode(we(500,"Internal Server Error"))),await i.close()}}catch{console.error("Unable to render error page")}return n}}finally{e.isDirty()||t(null)}}function Rt(e,t){if(e.endsWith(D)){const n=e.length-Te+(t?1:0);e=e.slice(0,n),e===""&&(e="/")}return e}var k="@isQData",D="/q-data.json",Te=D.length,xe=Symbol("RequestEvLoaders"),Re=Symbol("RequestEvMode"),ve=Symbol("RequestEvRoute"),O=Symbol("RequestEvQwikSerializer"),Ae=Symbol("RequestEvTrailingSlash"),_e="@routeName",I="@actionId",De="@actionFormData",vt="@nonce";function At(e,t,n,r,i,a,o){const{request:s,platform:c,env:l}=e,f=new Map,m=new ut(s.headers.get("cookie")),d=new Headers,h=new URL(s.url);h.pathname.endsWith(D)&&(h.pathname=h.pathname.slice(0,-Te),r&&!h.pathname.endsWith("/")&&(h.pathname+="/"),f.set(k,!0));let g=-1,y=null,w,T=e.locale,S=200;const Pe=async()=>{for(g++;g<n.length;){const u=n[g],p=globalThis.qcAsyncRequestStore,b=p!=null&&p.run?p.run(x,u,x):u(x);St(b)&&await b,g++}},C=()=>{if(y!==null)throw new Error("Response already sent")},M=(u,p)=>{if(C(),typeof u=="number"){S=u;const R=x.getWritableStream().getWriter();R.write(typeof p=="string"?F.encode(p):p),R.close()}else if(S=u.status,u.headers.forEach((b,R)=>{R.toLowerCase()!=="set-cookie"&&d.append(R,b)}),u.headers.getSetCookie().forEach(b=>{const R=b.indexOf("=");if(R===-1)return;const ke=b.slice(0,R).trim(),Oe=b.slice(R+1).trim();m.set(ke,Oe)}),u.body){const b=x.getWritableStream();u.body.pipeTo(b)}else x.getWritableStream().getWriter().close();return U()},U=()=>(g=le,new X),z={},x={[xe]:z,[Re]:e.mode,[Ae]:r,[ve]:t,[O]:a,cookie:m,headers:d,env:l,method:s.method,signal:s.signal,params:(t==null?void 0:t[1])??{},pathname:h.pathname,platform:c,query:h.searchParams,request:s,url:h,basePathname:i,sharedMap:f,get headersSent(){return y!==null},get exited(){return g>=le},get clientConn(){return e.getClientConn()},next:Pe,exit:U,cacheControl:(u,p="Cache-Control")=>{C(),d.set(p,Tt(u))},resolveValue:async u=>{const p=u.__id;if(u.__brand==="server_loader"&&!(p in z))throw new Error("You can not get the returned data of a loader that has not been executed for this request.");return z[p]},status:u=>typeof u=="number"?(C(),S=u,u):S,locale:u=>(typeof u=="string"&&(T=u),T||""),error:(u,p)=>(S=u,new K(u,p)),redirect:(u,p)=>{if(C(),S=u,p){const b=p.replace(/([^:])\/{2,}/g,"$1/");p!==b&&console.warn(`Redirect URL ${p} is invalid, fixing to ${b}`),d.set("Location",b)}return u>301&&!d.get("Cache-Control")&&d.set("Cache-Control","no-store"),U(),new Y},defer:u=>typeof u=="function"?u:()=>u,fail:(u,p)=>(C(),S=u,{failed:!0,...p}),text:(u,p)=>(d.set("Content-Type","text/plain; charset=utf-8"),M(u,p)),html:(u,p)=>(d.set("Content-Type","text/html; charset=utf-8"),M(u,p)),parseBody:async()=>w!==void 0?w:w=Dt(x,f,a),json:(u,p)=>(d.set("Content-Type","application/json; charset=utf-8"),M(u,JSON.stringify(p))),send:M,isDirty:()=>y!==null,getWritableStream:()=>{if(y===null){if(e.mode==="dev"){const u=f.get("@serverTiming");u&&d.set("Server-Timing",u.map(p=>`${p[0]};dur=${p[1]}`).join(","))}y=e.getWritableStream(S,d,m,o,x)}return y}};return Object.freeze(x)}function L(e){return e[xe]}function E(e){return e[Ae]}function _t(e){return e[ve]}function j(e){return e[Re]}var le=Number.MAX_SAFE_INTEGER,Dt=async({request:e,method:t,query:n},r,i)=>{var a;const o=((a=e.headers.get("content-type"))==null?void 0:a.split(/[;,]/,1)[0].trim())??"";if(o==="application/x-www-form-urlencoded"||o==="multipart/form-data"){const s=await e.formData();return r.set(De,s),Ct(s)}else{if(o==="application/json")return await e.json();if(o==="application/qwik-json"){if(t==="GET"&&n.has(re)){const s=n.get(re);if(s)try{return i._deserializeData(decodeURIComponent(s))}catch{}}return i._deserializeData(await e.text())}}},Ct=e=>[...e.entries()].reduce((n,[r,i])=>(r.split(".").reduce((a,o,s,c)=>{if(o.endsWith("[]")){const l=o.slice(0,-2);return a[l]=a[l]||[],a[l]=[...a[l],i]}return s<c.length-1?a[o]=a[o]||(Number.isNaN(+c[s+1])?{}:[]):a[o]=i},n),n),{});function Pt(e){const{url:t,params:n,request:r,status:i,locale:a}=e,o={};r.headers.forEach((y,w)=>o[w]=y);const s=e.sharedMap.get(I),c=e.sharedMap.get(De),l=e.sharedMap.get(_e),f=e.sharedMap.get(vt),m=e.request.headers,d=new URL(t.pathname+t.search,t),h=m.get("X-Forwarded-Host"),g=m.get("X-Forwarded-Proto");return h&&(d.port="",d.host=h),g&&(d.protocol=g),{url:d.href,requestHeaders:o,locale:a(),nonce:f,containerAttributes:{"q:route":l},qwikcity:{routeName:l,ev:e,params:{...n},loadedRoute:_t(e),response:{status:i(),loaders:L(e),action:s,formData:c}}}}var kt=(e,t,n,r,i)=>{const a=[],o=[],s=[],c=!!(t&&Nt(t[2]));if(e&&fe(a,o,s,e,c,n),t){const l=t[0];r&&(n==="POST"||n==="PUT"||n==="PATCH"||n==="DELETE")&&s.unshift(It),c&&((n==="POST"||n==="GET")&&s.push(Ht),s.push($t),s.push(Ft));const f=t[2];s.push(jt),fe(a,o,s,f,c,n),c&&(s.push(m=>{m.sharedMap.set(_e,l)}),s.push(Ot(o,a)),s.push(i))}return s},fe=(e,t,n,r,i,a)=>{for(const o of r){typeof o.onRequest=="function"?n.push(o.onRequest):Array.isArray(o.onRequest)&&n.push(...o.onRequest);let s;switch(a){case"GET":{s=o.onGet;break}case"POST":{s=o.onPost;break}case"PUT":{s=o.onPut;break}case"PATCH":{s=o.onPatch;break}case"DELETE":{s=o.onDelete;break}case"OPTIONS":{s=o.onOptions;break}case"HEAD":{s=o.onHead;break}}if(typeof s=="function"?n.push(s):Array.isArray(s)&&n.push(...s),i)for(const c of Object.values(o))typeof c=="function"&&(c.__brand==="server_loader"?e.push(c):c.__brand==="server_action"&&t.push(c))}};function Ot(e,t){return async n=>{if(n.headersSent){n.exit();return}const{method:r}=n,i=L(n),a=j(n)==="dev",o=n[O];if(a&&r==="GET"&&n.query.has(ne)&&console.warn(`Seems like you are submitting a Qwik Action via GET request. Qwik Actions should be submitted via POST request.
Make sure your <form> has method="POST" attribute, like this: <form method="POST">`),r==="POST"){const s=n.query.get(ne);if(s){const c=globalThis._qwikActionsMap,l=e.find(f=>f.__id===s)??(c==null?void 0:c.get(s));if(l){n.sharedMap.set(I,s);const f=await n.parseBody();if(!f||typeof f!="object")throw new Error(`Expected request data for the action id ${s} to be an object`);const m=await de(n,l.__validators,f,a);if(!m.success)i[s]=n.fail(m.status??500,m.error);else{const d=a?await N(n,l.__qrl.getSymbol().split("_",1)[0],()=>l.__qrl.call(n,m.data,n)):await l.__qrl.call(n,m.data,n);a&&W(o,d,l.__qrl),i[s]=d}}}}if(t.length>0){const s=t.map(c=>{const l=c.__id;return i[l]=de(n,c.__validators,void 0,a).then(f=>f.success?a?N(n,c.__qrl.getSymbol().split("_",1)[0],()=>c.__qrl.call(n,n)):c.__qrl.call(n,n):n.fail(f.status??500,f.error)).then(f=>(typeof f=="function"?i[l]=f():(a&&W(o,f,c.__qrl),i[l]=f),f)),i[l]});await Promise.all(s)}}}async function de(e,t,n,r){let i={success:!0,data:n};if(t)for(const a of t)if(r?i=await N(e,"validator$",()=>a.validate(e,n)):i=await a.validate(e,n),i.success)n=i.data;else return i;return i}function Mt(e){return e?typeof e=="object"&&Symbol.asyncIterator in e:!1}async function Ht(e){const t=e.query.get(mt);if(t&&e.request.headers.get("X-QRL")===t&&e.request.headers.get("Content-Type")==="application/qwik-json"){e.exit();const n=j(e)==="dev",r=e[O],i=await e.parseBody();if(Array.isArray(i)){const[a,...o]=i;if(Wt(a)&&a.getHash()===t){let s;try{n?s=await N(e,`server_${a.getSymbol()}`,()=>a.apply(e,o)):s=await a.apply(e,o)}catch(c){throw c instanceof K?e.error(c.status,c.data):e.error(500,"Invalid request")}if(Mt(s)){e.headers.set("Content-Type","text/qwik-json-stream");const l=e.getWritableStream().getWriter();for await(const f of s){n&&W(r,f,a);const m=await r._serializeData(f,!0);if(e.signal.aborted)break;await l.write(F.encode(`${m}
`))}l.close()}else{W(r,s,a),e.headers.set("Content-Type","application/qwik-json");const c=await r._serializeData(s,!0);e.send(200,c)}return}}throw e.error(500,"Invalid request")}}function $t(e){const t=E(e),{basePathname:n,pathname:r,url:i,sharedMap:a}=e;if(!a.has(k)&&r!==n&&!r.endsWith(".html")){if(t){if(!r.endsWith("/"))throw e.redirect(301,r+"/"+i.search)}else if(r.endsWith("/"))throw e.redirect(301,r.slice(0,r.length-1)+i.search)}}function W(e,t,n){try{e._verifySerializable(t,void 0)}catch(r){throw r instanceof Error&&n.dev&&(r.loc=n.dev),r}}var Wt=e=>typeof e=="function"&&typeof e.getSymbol=="function";function Nt(e){const t=e[e.length-1];return t&&typeof t.default=="function"}function Ce(e,t){e=new URL(e),e.pathname.endsWith(D)&&(e.pathname=e.pathname.slice(0,-D.length)),t?e.pathname.endsWith("/")||(e.pathname+="/"):e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1));const n=e.search.slice(1).replaceAll(/&?q(action|data|func)=[^&]+/g,"");return`${e.pathname}${n?`?${n}`:""}${e.hash}`}var F=new TextEncoder;function It(e){if(zt(e.request.headers,"application/x-www-form-urlencoded","multipart/form-data","text/plain")){const n=e.request.headers.get("origin"),r=e.url.origin;if(n!==r)throw e.error(403,`CSRF check failed. Cross-site ${e.method} form submissions are forbidden.
The request origin "${n}" does not match the server origin "${r}".`)}}function Lt(e){return async t=>{if(t.headersSent||t.sharedMap.has(k))return;t.request.headers.forEach((m,d)=>m);const r=t.headers;r.has("Content-Type")||r.set("Content-Type","text/html; charset=utf-8");const i=E(t),{readable:a,writable:o}=new TextEncoderStream,s=t.getWritableStream(),c=a.pipeTo(s,{preventClose:!0}),l=o.getWriter(),f=t.status();try{const m=j(t)==="static",d=Pt(t),h=await e({base:t.basePathname+"build/",stream:l,serverData:d,containerAttributes:{"q:render":m?"static":"",...d.containerAttributes}}),g={loaders:L(t),action:t.sharedMap.get(I),status:f!==200?f:200,href:Ce(t.url,i)};typeof h.html=="string"&&await l.write(h.html),t.sharedMap.set("qData",g)}finally{await l.ready,await l.close(),await c}await s.close()}}async function jt(e){if(!e.sharedMap.has(k))return;try{await e.next()}catch(a){if(!(a instanceof Y))throw a}if(e.headersSent)return;const n=e.status(),r=e.headers.get("Location");if(n>=301&&n<=308&&r){const a=Ut(r);if(a){e.headers.set("Location",a),e.getWritableStream().close();return}else e.status(200),e.headers.delete("Location")}}async function Ft(e){if(!e.sharedMap.has(k)||(await e.next(),e.headersSent||e.exited))return;const n=e.status(),r=e.headers.get("Location"),i=E(e);e.request.headers.forEach((l,f)=>l),e.headers.set("Content-Type","application/json; charset=utf-8");const a={loaders:L(e),action:e.sharedMap.get(I),status:n!==200?n:200,href:Ce(e.url,i),redirect:r??void 0},o=e.getWritableStream().getWriter(),c=await e[O]._serializeData(a,!0);o.write(F.encode(c)),e.sharedMap.set("qData",a),o.close()}function Ut(e){if(e.startsWith("/")){const t=D,n=new URL(e,"http://localhost");return(n.pathname.endsWith("/")?n.pathname.slice(0,-1):n.pathname)+(t.startsWith("/")?"":"/")+t+n.search}else return}function ue(){return typeof performance<"u"?performance.now():0}async function N(e,t,n){const r=ue();try{return await n()}finally{const i=ue()-r;let a=e.sharedMap.get("@serverTiming");a||e.sharedMap.set("@serverTiming",a=[]),a.push([t,i])}}function zt(e,...t){var n;const r=((n=e.get("content-type"))==null?void 0:n.split(/;/,1)[0].trim())??"";return t.includes(r)}async function Qt(e,t,n){const{render:r,qwikCityPlan:i,checkOrigin:a}=t,o=e.url.pathname,s=Rt(o,i.trailingSlash),c=await Gt(i,s,e.request.method,a??!0,r);if(c){const[l,f]=c;return xt(e,l,f,i.trailingSlash,i.basePathname,n)}return null}async function Gt(e,t,n,r,i){const{routes:a,serverPlugins:o,menus:s,cacheModules:c}=e,l=await wt(a,s,c,t),f=kt(o,l,n,r,Lt(i));return f.length>0?[l,f]:null}function B(e,t){var n;return((n=t==null?void 0:t.getOrigin)==null?void 0:n.call(t,e))??(t==null?void 0:t.origin)??process.env.ORIGIN??Bt(e)}function Bt(e){const{PROTOCOL_HEADER:t,HOST_HEADER:n}=process.env,r=e.headers,i=t&&r[t]||(e.socket.encrypted||e.connection.encrypted?"https":"http"),a=n??(e instanceof Ue?":authority":"host"),o=r[a];return`${i}://${o}`}function J(e,t){return Kt(e.originalUrl||e.url||"/",t)}function Jt(e=""){return["The stream has been destroyed","write after end"].some(n=>e.includes(n))}var me=/^:(method|scheme|authority|path)$/i;function Kt(e,t){const n=/\/\/|\\\\/g;return new URL(e.replace(n,"/"),t)}async function Xt(e,t,n,r,i){const a=new Headers,o=t.headers;try{for(const[d,h]of Object.entries(o))if(!me.test(d)){if(typeof h=="string")a.set(d,h);else if(Array.isArray(h))for(const g of h)a.append(d,g)}}catch(d){console.error(d)}const s=async function*(){for await(const d of t)yield d},c=t.method==="HEAD"||t.method==="GET"?void 0:s(),l=new AbortController,f={method:t.method,headers:a,body:c,signal:l.signal,duplex:"half"};return n.on("close",()=>{l.abort()}),{mode:r,url:e,request:new Request(e.href,f),env:{get(d){return process.env[d]}},getWritableStream:(d,h,g)=>{n.statusCode=d;try{for(const[w,T]of h)me.test(w)||n.setHeader(w,T);const y=g.headers();y.length>0&&n.setHeader("Set-Cookie",y)}catch(y){console.error(y)}return new WritableStream({write(y){n.closed||n.destroyed||n.write(y,w=>{w&&!Jt(w.message)&&console.error(w)})},close(){n.end()}})},getClientConn:()=>i?i(t):{ip:t.socket.remoteAddress},platform:{ssr:!0,incomingMessage:t,node:process.versions.node},locale:void 0}}var Yt={"3gp":"video/3gpp","3gpp":"video/3gpp",asf:"video/x-ms-asf",asx:"video/x-ms-asf",avi:"video/x-msvideo",avif:"image/avif",bmp:"image/x-ms-bmp",css:"text/css",flv:"video/x-flv",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",jng:"image/x-jng",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",kar:"audio/midi",m4a:"audio/x-m4a",m4v:"video/x-m4v",mid:"audio/midi",midi:"audio/midi",mng:"video/x-mng",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",ogg:"audio/ogg",pdf:"application/pdf",png:"image/png",rar:"application/x-rar-compressed",shtml:"text/html",svg:"image/svg+xml",svgz:"image/svg+xml",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",txt:"text/plain",wbmp:"image/vnd.wap.wbmp",webm:"video/webm",webp:"image/webp",wmv:"video/x-ms-wmv",woff:"font/woff",woff2:"font/woff2",xml:"text/xml",zip:"application/zip"};function Et(){typeof global<"u"&&typeof globalThis.fetch!="function"&&typeof process<"u"&&process.versions.node&&(globalThis.fetch=Je,globalThis.Headers=Ke,globalThis.Request=Xe,globalThis.Response=Ye,globalThis.FormData=Ee),typeof globalThis.TextEncoderStream>"u"&&(globalThis.TextEncoderStream=ze,globalThis.TextDecoderStream=Qe),typeof globalThis.WritableStream>"u"&&(globalThis.WritableStream=Ge,globalThis.ReadableStream=Be),typeof globalThis.crypto>"u"&&(globalThis.crypto=Ze.webcrypto)}function Zt(e){var t;Et();const n={_deserializeData:et,_serializeData:qe,_verifySerializable:Ve};e.manifest&&Ie(e.manifest);const r=((t=e.static)==null?void 0:t.root)??A(ye(import.meta.url),"..","..","dist");return{router:async(s,c,l)=>{try{const f=B(s,e),m=await Xt(J(s,f),s,c,"server",e.getClientConn),d=await Qt(m,e,n);if(d){const h=await d.completion;if(h)throw h;if(d.requestEv.headersSent)return}l()}catch(f){console.error(f),l(f)}},notFound:async(s,c,l)=>{try{if(!c.headersSent){const f=B(s,e),m=J(s,f),d=V(s.method||"GET",m)?"Not Found":je(m.pathname);c.writeHead(404,{"Content-Type":"text/html; charset=utf-8","X-Not-Found":m.pathname}),c.end(d)}}catch(f){console.error(f),l(f)}},staticFile:async(s,c,l)=>{var f;try{const m=B(s,e),d=J(s,m);if(V(s.method||"GET",d)){const h=d.pathname;let g;We(h).includes(".")?g=A(r,h):e.qwikCityPlan.trailingSlash?g=A(r,h+"index.html"):g=A(r,h,"index.html");const y=Ne(g).replace(/^\./,""),w=Fe(g);w.on("error",l);const T=Yt[y];T&&c.setHeader("Content-Type",T),(f=e.static)!=null&&f.cacheControl&&c.setHeader("Cache-Control",e.static.cacheControl),w.pipe(c);return}return l()}catch(m){console.error(m),l(m)}}}}const{router:Vt,notFound:qt}=Zt({render:Le,qwikCityPlan:tt}),en=async(e,t)=>{const{buildDir:n,distDir:r,assetsDir:i}=t;e.register(Q,{root:n,prefix:"/build",immutable:!0,maxAge:"1y",decorateReply:!1}),e.register(Q,{root:i,prefix:"/assets",immutable:!0,maxAge:"1y"}),e.register(Q,{root:r,redirect:!1,decorateReply:!1}),e.removeAllContentTypeParsers(),e.setNotFoundHandler(async(a,o)=>{await Vt(a.raw,o.raw,s=>e.log.error(s)),await qt(a.raw,o.raw,s=>e.log.error(s))})},tn=nt(en,{fastify:">=4.0.0 <6.0.0"}),Z=A(ye(import.meta.url),"..","..","dist"),nn=A(Z,"build"),rn=A(Z,"assets"),an=parseInt(process.env.PORT??"3000"),sn=process.env.HOST??"0.0.0.0",on=async()=>{const e=$e({logger:!0});await e.register(tn,{distDir:Z,buildDir:nn,assetsDir:rn}),await e.listen({port:an,host:sn})};on();
